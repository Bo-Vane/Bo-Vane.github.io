---
layout: post
title: "Dockerå­¦ä¹ "
date:   2023-5-10
tags: [Docker]
comments: true
author: Bo
---

# :book:Dockerå­¦ä¹ 

ğŸ‘€ä¸ªäººä¸»é¡µï¼šhttps://github.com/Bo-VaneğŸ
ğŸ§‘ä¸ªäººç®€ä»‹ï¼šä¸€ä¸ªä¸æ–­æé«˜è‡ªæˆ‘çš„å¹³å‡¡äººğŸš€
ğŸ‘Šæ ¼è¨€ï¼šâ˜€ï¸æ‡‚çš„è¶Šå¤šï¼Œæ‡‚çš„è¶Šå°‘â˜€ï¸
ğŸ‘‰è®©æˆ‘ä»¬ä¸€èµ·è¿›æ­¥ï¼Œä¸€èµ·æˆä¸ºæ›´å¥½çš„è‡ªå·±ï¼ï¼ï¼ğŸ

## 1.ä¸ºä»€ä¹ˆéœ€è¦Docker

ä¸€æ¬¾äº§å“:å¼€å‘--ä¸Šçº¿ä¸¤å¥—ç¯å¢ƒ!åº”ç”¨ç¯å¢ƒï¼Œåº”ç”¨é…ç½®!

å¼€å‘--è¿ç»´ã€‚é—®é¢˜âˆ¶æˆ‘åœ¨æˆ‘çš„ç”µè„‘ä¸Šå¯ä»¥è¿è¡Œ!ç‰ˆæœ¬æ›´æ–°ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨!å¯¹äºè¿ç»´æ¥è¯´ï¼Œè€ƒéªŒå°±ååˆ†å¤§?ç¯å¢ƒé…ç½®æ˜¯ååˆ†çš„éº»çƒ¦ï¼Œæ¯ä¸€ä¸ªæœºå™¨éƒ½è¦éƒ¨ç½²ç¯å¢ƒï¼ˆé›†ç¾¤Redisã€ESã€Hadoop....)!è´¹æ—¶è´¹åŠ›ã€‚

å‘å¸ƒä¸€ä¸ªé¡¹ç›®( jar + ( Redis MysQL jdk ES ) )ï¼Œé¡¹ç›®èƒ½ä¸èƒ½éƒ½å¸¦ä¸Šç¯å¢ƒå®‰è£…æ‰“åŒ…!

ä¹‹å‰åœ¨æœåŠ¡å™¨é…ç½®ä¸€ä¸ªåº”ç”¨çš„ç¯å¢ƒRedis MySQL jdk ES Hadoopï¼Œé…ç½®è¶…éº»çƒ¦äº†ï¼Œä¸èƒ½å¤Ÿè·¨å¹³å°ã€‚Windowsï¼Œæœ€åå‘å¸ƒåˆ°Linux !

ä¼ ç»Ÿâˆ¶å¼€å‘åªç»™jarï¼Œè¿ç»´æ¥åš!
ç°åœ¨âˆ¶å¼€å‘æ‰“åŒ…éƒ¨ç½²ä¸Šçº¿ï¼Œä¸€å¥—æµç¨‹åšå®Œ!
java -- apk --å‘å¸ƒï¼ˆåº”ç”¨å•†åº—)---.å¼ ä¸‰ä½¿ç”¨apk ---å®‰è£…å³å¯ç”¨!
java -- jar (ç¯å¢ƒ) .--æ‰“åŒ…é¡¹ç›®å¸¦ä¸Šç¯å¢ƒï¼ˆé•œåƒ) ---( Dockerä»“åº“:å•†åº—)---ä¸‹è½½æˆ‘ä»¬å‘å¸ƒçš„é•œåƒ---ç›´æ¥è¿è¡Œå³å¯!

![image-20231113160127938](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311131601294.png)

Dockerçš„æ€æƒ³å°±æ¥è‡ªäºé›†è£…ç®±!
JRE--å¤šä¸ªåº”ç”¨ï¼ˆç«¯å£å†²çªï¼‰---åŸæ¥éƒ½æ˜¯äº¤å‰çš„!
éš”ç¦»:Dockeræ ¸å¿ƒæ€æƒ³!æ‰“åŒ…è£…ç®±!æ¯ä¸ªç®±å­æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚æ°´æœç”ŸåŒ–æ­¦å™¨
Dockeré€šè¿‡éš”ç¦»æœºåˆ¶ï¼Œå¯ä»¥å°†æœåŠ¡å™¨åˆ©ç”¨åˆ°æè‡´!

##  2.:raised_hand:å®¹å™¨çš„å¿…è¦æ€§

åœ¨å®¹å™¨æŠ€æœ¯å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨è™šæ‹ŸæœºæŠ€æœ¯!
è™šæ‹Ÿæœº:åœ¨windowä¸­è£…ä¸€ä¸ªVmwareï¼Œé€šè¿‡è¿™ä¸ªè½¯ä»¶æˆ‘ä»¬å¯ä»¥è™šæ‹Ÿå‡ºæ¥ä¸€å°æˆ–è€…å¤šå°ç”µè„‘!ç¬¨é‡!è™šæ‹Ÿæœºä¹Ÿæ˜¯å±äºè™šæ‹ŸåŒ–æŠ€æœ¯ï¼ŒDockerå®¹å™¨æŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯!

```
vm :  linux centosåŸç”Ÿé•œåƒï¼ˆä¸€ä¸ªç”µè„‘!)â€•éš”ç¦»ï¼Œéœ€è¦å¼€å¯å¤šä¸ªè™šæ‹Ÿæœº!â€•å‡ ä¸ªGå‡ åˆ†é’Ÿ
docker:éš”ç¦»ï¼Œé•œåƒï¼ˆæœ€æ ¸å¿ƒçš„ç¯å¢ƒ4m + jdk + mysq1)ååˆ†çš„å°å·§ï¼Œè¿è¡Œé•œåƒå°±å¯ä»¥äº†!å°å·§!å‡ ä¸ªM KBç§’çº§å¯åŠ¨!
```

> dockeræ˜¯åŸºäºgoè¯­è¨€å¼€å‘çš„å¼€æºé¡¹ç›®

:sheep:  å®˜ç½‘ï¼š https://www.docker.com/

:sheep:  æ–‡æ¡£ï¼šhttps://docs.docker.com/        å¾ˆè¯¦ç»†ï¼

## 3. Dockerèƒ½åšä»€ä¹ˆ

> ä¹‹å‰çš„è™šæ‹ŸæœºæŠ€æœ¯

![img](https://img-blog.csdnimg.cn/img_convert/e440c7d10ff2727fd6d5465fb6ef4988.jpeg)
è™šæ‹ŸæœºæŠ€æœ¯ç¼ºç‚¹ï¼š
1ã€èµ„æºå ç”¨ååˆ†å¤š
2ã€å†—ä½™æ­¥éª¤å¤š
3ã€å¯åŠ¨å¾ˆæ…¢ï¼

> å®¹å™¨åŒ–æŠ€æœ¯

**å®¹å™¨åŒ–æŠ€æœ¯ä¸æ˜¯æ¨¡æ‹Ÿçš„ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ**
![img](https://img-blog.csdnimg.cn/img_convert/47a51e0d5fddebea74e86fbc49c90812.jpeg)

æ¯”è¾ƒDockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„ä¸åŒï¼š

- ä¼ ç»Ÿè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿå‡ºä¸€æ¡ç¡¬ä»¶ï¼Œè¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œç„¶ååœ¨è¿™ä¸ªç³»ç»Ÿä¸Šå®‰è£…å’Œè¿è¡Œè½¯ä»¶ã€‚
- å®¹å™¨å†…çš„åº”ç”¨ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºçš„å†…æ ¸ä¸­ï¼Œå®¹å™¨æ˜¯æ²¡æœ‰è‡ªå·±çš„å†…æ ¸çš„ï¼Œä¹Ÿæ²¡æœ‰è™šæ‹Ÿæˆ‘ä»¬çš„ç¡¬ä»¶ï¼Œæ‰€ä»¥å°±è½»ä¾¿äº†ã€‚
- æ¯ä¸ªå®¹å™¨é—´æ˜¯äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨å†…éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿï¼Œäº’ä¸å½±å“ã€‚

> Devopsï¼ˆå¼€å‘ã€è¿ç»´ï¼‰

**åº”ç”¨æ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²**

ä¼ ç»Ÿï¼šä¸€å †å¸®åŠ©æ–‡æ¡£ï¼Œå®‰è£…ç¨‹åº!
Dockerï¼šæ‰“åŒ…é•œåƒå‘å¸ƒæµ‹è¯•ï¼Œä¸€é”®è¿è¡Œ!

**æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹**

ä½¿ç”¨äº†Dockerä¹‹åï¼Œæˆ‘ä»¬éƒ¨ç½²åº”ç”¨å°±å’Œæ­ç§¯æœ¨ä¸€æ ·ï¼
é¡¹ç›®æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œæ‰©å±•æœåŠ¡å™¨Aï¼æœåŠ¡å™¨B!

**æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´**

åœ¨å®¹å™¨åŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„å¼€å‘ï¼Œæµ‹è¯•ç¯å¢ƒéƒ½æ˜¯é«˜åº¦ä¸€è‡´çš„ã€‚

**æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨**

Dockeræ˜¯å†…æ ¸çº§åˆ«çš„è™šæ‹ŸåŒ–ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç‰©ç†æœºä¸Šå¯ä»¥è¿è¡Œå¾ˆå¤šçš„å®¹å™¨å®ä¾‹ï¼æœåŠ¡å™¨çš„æ€§èƒ½å¯ä»¥è¢«å‹æ¦¨åˆ°æè‡´ã€‚
åªè¦å­¦ä¸æ­»ï¼Œå°±å¾€æ­»é‡Œå­¦ï¼

# äºŒã€Dockerå®‰è£…

## 1. Dockerçš„åŸºæœ¬ç»„æˆ

![img](https://img-blog.csdnimg.cn/img_convert/03e39bfb64ffd63d93e4baee45358500.jpeg)
**é•œåƒï¼ˆimageï¼‰ï¼š**
dockeré•œåƒå°±å¥½æ¯”æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¨¡æ¿æ¥åˆ›å»ºå®¹å™¨æœåŠ¡ï¼Œtomcaté•œåƒ===>run==>tomcat01å®¹å™¨ï¼ˆæä¾›æœåŠ¡å™¨ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼ˆæœ€ç»ˆæœåŠ¡è¿è¡Œæˆ–è€…é¡¹ç›®è¿è¡Œå°±æ˜¯åœ¨å®¹å™¨ä¸­çš„ï¼‰ã€‚

**å®¹å™¨ï¼ˆcontainerï¼‰ï¼š**
Dockeråˆ©ç”¨å®¹å™¨æŠ€æœ¯ï¼Œç‹¬ç«‹è¿è¡Œä¸€ä¸ªæˆ–è€…ä¸€ä¸ªç»„åº”ç”¨ï¼Œé€šè¿‡é•œåƒæ¥åˆ›å»ºçš„ã€‚
å¯åŠ¨ï¼Œåœæ­¢ï¼Œåˆ é™¤ï¼ŒåŸºæœ¬å‘½ä»¤ï¼
ç›®å‰å°±å¯ä»¥æŠŠè¿™ä¸ªå®¹å™¨ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªç®€æ˜“çš„linuxç³»ç»Ÿ

**ä»“åº“ï¼ˆrepositoryï¼‰ï¼š**
ä»“åº“å°±æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼
ä»“åº“åˆ†ä¸ºå…¬æœ‰ä»“åº“å’Œç§æœ‰ä»“åº“ï¼
Docker Hubï¼ˆé»˜è®¤æ˜¯å›½å¤–çš„ï¼‰é˜¿é‡Œäº‘.â€¦éƒ½æœ‰å®¹å™¨æœåŠ¡å™¨ï¼ˆé…ç½®é•œåƒåŠ é€Ÿï¼ï¼‰

## 2. å®‰è£…Docker

> ç¯å¢ƒå‡†å¤‡

1. éœ€è¦ä¼šä¸€ç‚¹ç‚¹çš„Linuxçš„åŸºç¡€
2. CentOS7
3. æˆ‘ä»¬ä½¿ç”¨Xshellè¿æ¥è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œæ“ä½œ

> ç¯å¢ƒæŸ¥çœ‹

```
# ç³»ç»Ÿå†…æ ¸æ˜¯ 3.10 ä»¥ä¸Šçš„
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# uname -r
3.10.0-1160.66.1.el7.x86_64
```

```

```

> å®‰è£…

æŸ¥çœ‹æ–‡æ¡£ï¼šhttps://docs.docker.com/ ï¼ˆhttps://docs.docker.com/engine/install/centos/ï¼‰

```
# 1.å¸è½½æ—§çš„ç‰ˆæœ¬
yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
# 2.éœ€è¦çš„å®‰è£…åŒ…
yum install -y yum-utils
# 3.è®¾ç½®é•œåƒçš„ä»“åº“
yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo # é»˜è®¤æ˜¯ä»å›½å¤–çš„ã€‚
yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # æ¨èä½¿ç”¨é˜¿é‡Œäº‘çš„ã€‚
# å®‰è£…å®¹å™¨ä¹‹å‰ï¼Œæ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•ã€‚
yum makecache fast
# 4.å®‰è£…å®¹å™¨ç›¸å…³çš„ã€‚docker-ceï¼ˆç¤¾åŒºç‰ˆï¼‰docker-eeï¼ˆä¼ä¸šç‰ˆï¼‰
yum install docker-ce docker-ce-cli containerd.io
# 5.å¯åŠ¨docker
systemctl start docker
# 6.ä½¿ç”¨docker versionæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ
```



![img](https://img-blog.csdnimg.cn/img_convert/2a1f4bd8256c5eeb757fbb7df38fd525.jpeg)

```
# 7.æµ‹è¯•hello-world
docker run hello-world
```

![img](https://img-blog.csdnimg.cn/img_convert/109805f24d08cd2e1056bfaec01c3057.jpeg)

```
# 8.æŸ¥çœ‹ä¸€ä¸‹ä¸‹è½½çš„è¿™ä¸ªhello-worldé•œåƒ
```

> äº†è§£ï¼šå¸è½½docker

```
# 1.å¸è½½ä¾èµ–yum remove docker-ce docker-ce-cli containerd.io
# 2.åˆ é™¤èµ„æºrm -rf /var/lib/docker
           rm -rf /var/lib/containerd          # /var/lib/docker  dockerçš„é»˜è®¤å·¥ä½œè·¯å¾„
```

## 3. é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ

1. ç™»å½•é˜¿é‡Œäº‘ï¼Œæ‰¾åˆ°å®¹å™¨æœåŠ¡ã€‚https://cr.console.aliyun.com/cn-chengdu/instances/mirrors
2. æ‰¾åˆ°é•œåƒåŠ é€Ÿåœ°å€ã€‚
3. é…ç½®ä½¿ç”¨ã€‚
   å››ä¸ªå‘½ä»¤ï¼Œä¾æ¬¡æ‰§è¡Œå³å¯ï¼š

```bash
sudo mkdir -p /etc/docker
```

```bash
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://xyheam17.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

## 4. å›é¡¾hello-worldæµç¨‹

![image-20231114171657079](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311141717355.png)

## 5. åº•å±‚åŸç†

Dockeræ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ
Docker æ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerçš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šã€‚é€šè¿‡Socketä»å®¢æˆ·ç«¯è®¿é—®ï¼
DockerServer æ¥æ”¶åˆ°Docker-Clientçš„æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼

![image-20231114172151430](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311141721950.png)

**Dockerä¸ºä»€ä¹ˆæ¯”VMå¿«ï¼Ÿ**
1ã€Dockeræœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ã€‚
2ã€dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œvméœ€è¦æ˜¯Guest OSã€‚

![image-20231114172352365](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311141723403.png)

æ‰€ä»¥è¯´ï¼Œæ–°å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œdockerä¸éœ€è¦åƒè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œé¿å…å¼•å¯¼ã€‚
è™šæ‹Ÿæœºæ˜¯åŠ è½½GuestOSï¼Œåˆ†é’Ÿçº§åˆ«çš„ï¼Œè€Œdockeræ˜¯åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œçœç•¥äº†è¿™ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œç§’çº§ï¼

# ä¸‰ã€Dockerçš„å¸¸ç”¨å‘½ä»¤

## 1. å¸®åŠ©å‘½ä»¤

```bash
docker version        # æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯
docker info              # æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡
docker å‘½ä»¤ --help         # å¸®åŠ©å‘½ä»¤
```

å¸®åŠ©æ–‡æ¡£çš„åœ°å€ï¼šhttps://docs.docker.com/reference/

## 2. é•œåƒå‘½ä»¤

### dokcer images

æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°çš„ä¸»æœºä¸Šçš„é•œåƒ

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    feb5d9fea6a5   10 months ago   13.3kB
# è§£é‡Š
REPOSITORY    é•œåƒçš„ä»“åº“æº
TAG            é•œåƒçš„æ ‡ç­¾
IMAGE ID    é•œåƒçš„id
CREATED        é•œåƒçš„åˆ›å»ºæ—¶é—´
SIZE        é•œåƒçš„å¤§å°
# å‘½ä»¤å‚æ•°å¯é€‰é¡¹
 -a, --all         # æ˜¾ç¤ºæ‰€æœ‰é•œåƒ (docker images -a)
 -q, --quiet       # ä»…æ˜¾ç¤ºé•œåƒid (docker images -q)
```

### docker search

:warning:   æœç´¢é•œåƒ

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker search mysql
NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                          MySQL is a widely used, open-source relationâ€¦   12940     [OK]
mariadb                        MariaDB Server is a high performing open souâ€¦   4957      [OK]
phpmyadmin                     phpMyAdmin - A web interface for MySQL and Mâ€¦   587       [OK]
percona                        Percona Server is a fork of the MySQL relatiâ€¦   582       [OK]
# è§£é‡Š
# å‘½ä»¤å‚æ•°å¯é€‰é¡¹ (é€šè¿‡æœç´¢æ¥è¿‡æ»¤)
--filter=STARS=3000     # æœç´¢å‡ºæ¥çš„é•œåƒå°±æ˜¯starså¤§äº3000çš„
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker search mysql --filter=STARS=3000
NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql     MySQL is a widely used, open-source relationâ€¦   12941     [OK]
mariadb   MariaDB Server is a high performing open souâ€¦   4957      [OK]
```

### docker pull

ä¸‹è½½é•œåƒ

```bash
# ä¸‹è½½é•œåƒï¼šdocker pull é•œåƒå[:tag]
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker pull mysql
Using default tag: latest            # å¦‚æœä¸å†™tagï¼Œé»˜è®¤å°±æ˜¯latestï¼Œæœ€æ–°çš„ç‰ˆæœ¬
latest: Pulling from library/mysql
72a69066d2fe: Pull complete            # åˆ†å±‚ä¸‹è½½ï¼Œdocker imageçš„æ ¸å¿ƒï¼Œè”åˆæ–‡ä»¶ä¸‹è½½
93619dbc5b36: Pull complete
99da31dd6142: Pull complete
626033c43d70: Pull complete
37d5d7efb64e: Pull complete
ac563158d721: Pull complete
d2ba16033dad: Pull complete
688ba7d5c01a: Pull complete
00e060b6d11d: Pull complete
1c04857f594f: Pull complete
4d7cfa90e6ea: Pull complete
e0431212d27d: Pull complete
Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709 #ç­¾å
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest        # çœŸå®åœ°å€
# ä¸¤ä¸ªå‘½ä»¤æ˜¯ç­‰ä»·çš„
docker pull mysql
docker pull docker.io/library/mysql:latest
# æŒ‡å®šç‰ˆæœ¬ä¸‹è½½
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker pull mysql:5.7
é‡å¤çš„æ–‡ä»¶ä¸ç”¨å†ä¸‹è½½ï¼Œè¿™å°±æ˜¯åˆ†å±‚ä¸‹è½½çš„å¥½å¤„
```

### docker rmi

åˆ é™¤é•œåƒ

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker rmi -f é•œåƒid                    # åˆ é™¤æŒ‡å®šçš„é•œåƒ
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker rmi -f é•œåƒid é•œåƒid é•œåƒid    # åˆ é™¤å¤šä¸ªé•œåƒï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker rmi -f $(docker images -aq)    # åˆ é™¤å…¨éƒ¨çš„é•œåƒ
```

## 3. å®¹å™¨å‘½ä»¤

è¯´æ˜ï¼šæˆ‘ä»¬æœ‰äº†é•œåƒæ‰å¯ä»¥åˆ›å»ºå®¹å™¨ï¼Œlinuxï¼Œä¸‹è½½ä¸€ä¸ªcentos é•œåƒæ¥æµ‹è¯•å­¦ä¹ ã€‚

```
docker pull centos
```

### æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨

```bash
docker run [å¯é€‰å‚æ•°] image
# å‚æ•°è¯´æ˜
--name="name"        å®¹å™¨åå­—ï¼šç”¨æ¥åŒºåˆ†å®¹å™¨
-d                    åå°æ–¹å¼è¿è¡Œï¼šç›¸å½“äºnohup
-it                    ä½¿ç”¨äº¤äº’å¼è¿è¡Œï¼šè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹
-p                    æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå››ç§æ–¹å¼ï¼‰å°å†™å­—æ¯p
    -p ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£
    -p ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£
    -p å®¹å™¨ç«¯å£
    å®¹å™¨ç«¯å£
-P                     éšæœºæŒ‡å®šç«¯å£ï¼ˆå¤§å†™å­—æ¯Pï¼‰
# æµ‹è¯•ï¼šå¯åŠ¨å¹¶è¿›å…¥å®¹å™¨
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -it centos /bin/bash
[root@526c31d2c298 /]# ls        # æŸ¥çœ‹å®¹å™¨å†…çš„centosï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼Œå¾ˆå¤šå‘½ä»¤éƒ½æ˜¯ä¸å®Œå–„çš„ï¼‰
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
# ä»å®¹å™¨ä¸­é€€å›åˆ°ä¸»æœº
[root@526c31d2c298 /]# exit
exit
[root@iZbp13qr3mm4ucsjumrlgqZ /]# ls
bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  www
```

### åˆ—å‡ºæ‰€æœ‰è¿è¡Œçš„å®¹å™¨

```bash
docker ps    # åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
# å‘½ä»¤å‚æ•°å¯é€‰é¡¹
-a        # åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²è¿è¡Œè¿‡çš„å®¹å™¨
-n=?    # æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ï¼ˆå¯ä»¥æŒ‡å®šæ˜¾ç¤ºå‡ æ¡ï¼Œæ¯”å¦‚-n=1ï¼‰
-q        # åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·
```

### é€€å‡ºå®¹å™¨

```bash
exit        # å®¹å™¨ç›´æ¥åœæ­¢ï¼Œå¹¶é€€å‡º
ctrl+P+Q    # å®¹å™¨ä¸åœæ­¢ï¼Œé€€å‡º

```

### åˆ é™¤å®¹å™¨

```bash
docker rm å®¹å™¨id                    # åˆ é™¤å®¹å™¨ï¼ˆä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼‰å¦‚æœè¦å¼ºåˆ¶åˆ é™¤ï¼šdocker rm -f å®¹å™¨id
docker rm -f $(docker ps -aq)        # åˆ é™¤å…¨éƒ¨å®¹å™¨
docker ps -a -q|xargs docker rm        # åˆ é™¤æ‰€æœ‰å®¹å™¨
```

### å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ

```bash
docker start å®¹å™¨id        # å¯åŠ¨å®¹å™¨
docker restart å®¹å™¨id    # é‡å¯å®¹å™¨
docker stop å®¹å™¨id        # åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
docker kill å®¹å™¨id        # å¼ºåˆ¶åœæ­¢å½“å‰å®¹å™¨
```

## 4. å¸¸ç”¨å…¶ä»–å‘½ä»¤

### åå°å¯åŠ¨å®¹å™¨

```bash
# å‘½ä»¤docker run -d é•œåƒå
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d centos
# é—®é¢˜ï¼šdocker pså‘ç°centosåœæ­¢äº†
# å¸¸è§çš„å‘ï¼šdockerå®¹å™¨ä½¿ç”¨åå°è¿è¡Œï¼Œå°±å¿…é¡»è¦æœ‰è¦ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œdockerå‘ç°æ²¡æœ‰åº”ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨åœæ­¢ã€‚
# æ¯”å¦‚ï¼šnginxï¼Œå®¹å™¨å¯åŠ¨åï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æä¾›æœåŠ¡ï¼Œå°±ä¼šç«‹åˆ»åœæ­¢ï¼Œå°±æ˜¯æ²¡æœ‰ç¨‹åºäº†
```

### æŸ¥çœ‹æ—¥å¿—

```bash
docker logs -tf --tail å®¹å™¨id
# è‡ªå·±ç¼–å†™ä¸€æ®µshellè„šæœ¬
docker run -d centos /bin/sh -c "while true;do echo ku;sleep 1;done"
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker logs -tf  å®¹å™¨id
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker logs -tf --tail 10  å®¹å™¨id
# æ˜¾ç¤ºæ—¥å¿—
-tf                        # æ˜¾ç¤ºæ—¥å¿—
--tail number    # è¦æ˜¾ç¤ºçš„æ—¥å¿—æ¡æ•°
```



### æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹çš„ä¿¡æ¯

```bsah
# å‘½ä»¤ docker top å®¹å™¨id 
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker top 88d23bcbe1f2
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                21212               21193               0                   16:23               ?                   00:00:00            
root                21600               21212               0                   16:29               ?                   00:00:00
```

### æŸ¥çœ‹é•œåƒçš„å…ƒæ•°æ®

```bash
# å‘½ä»¤docker inspect å®¹å™¨id
```

### è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨

1. `# æˆ‘ä»¬é€šå¸¸å®¹å™¨éƒ½æ˜¯ä½¿ç”¨åå°æ–¹å¼è¿è¡Œçš„ï¼Œéœ€è¦è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹ä¸€äº›é…ç½®`
2. `# å‘½ä»¤`
3. `docker exec -it å®¹å™¨id /bin/bash`

1. `# æ–¹å¼äºŒ`
2. `docker attach å®¹å™¨id`
3. `# æµ‹è¯•`
4. `[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker attach 88d23bcbe1f2`
5. `æ­£åœ¨æ‰§è¡Œå½“å‰çš„ä»£ç ...`
6. `# docker exec        # è¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥å†é‡Œé¢æ“ä½œï¼ˆå¸¸ç”¨ï¼‰`
7. `# docker attach        # è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚`

### ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š

```bash
docker cp å®¹å™¨id:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºçš„è·¯å¾„
[root@iZbp13qr3mm4ucsjumrlgqZ home]# ll
total 0
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker run -it centos /bin/bash
[root@6eda31ad7987 /]# [root@iZbp13qr3mm4ucsjumrlgqZ home]# docker ps
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
6eda31ad7987   centos    "/bin/bash"   17 seconds ago   Up 16 seconds             stoic_kepler
# è¿›å…¥åˆ°å®¹å™¨å†…éƒ¨
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker attach 6eda31ad7987
[root@6eda31ad7987 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@6eda31ad7987 /]# cd /home/
[root@6eda31ad7987 home]# ls
# åœ¨å®¹å™¨çš„/homeè·¯å¾„ä¸‹åˆ›å»ºtest.javaæ–‡ä»¶
[root@6eda31ad7987 home]# touch test.java
[root@6eda31ad7987 home]# ls
test.java
[root@6eda31ad7987 home]# exit
exit
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker ps -a
CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS                      PORTS     NAMES
6eda31ad7987   centos    "/bin/bash"   About a minute ago   Exited (0) 28 seconds ago             stoic_kepler
# å°†æ–‡ä»¶æ‹·è´å‡ºæ¥åˆ°ä¸»æœºä¸Šï¼ˆåœ¨ä¸»æœºä¸Šæ‰§è¡Œè¯¥å‘½ä»¤ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ home]# docker cp 6eda31ad7987:/home/test.java /home
[root@iZbp13qr3mm4ucsjumrlgqZ home]# ls
test.java
# æ‹·è´æ˜¯ä¸€ä¸ªæ‰‹åŠ¨è¿‡ç¨‹ï¼Œæœªæ¥æˆ‘ä»¬ä½¿ç”¨ -v å·çš„æŠ€æœ¯ï¼Œå¯ä»¥å®ç°ï¼Œè‡ªåŠ¨åŒæ­¥ï¼ˆå®¹å™¨å†…çš„/homeè·¯å¾„å’Œä¸»æœºä¸Šçš„/homeè·¯å¾„æ‰“é€šï¼‰
```

## 5. ä½œä¸šç»ƒä¹ 

### dockerå®‰è£…nginx

1. æœç´¢é•œåƒï¼šdocker search nginx (å»ºè®®å»dockerHubä¸Šå»æœç´¢)
2. ä¸‹è½½é•œåƒï¼šdocker pull nginx

å¯åŠ¨nginxï¼š

```bash
# -d åå°è¿è¡Œ
# --name="nginx01"    ç»™å®¹å™¨å‘½å
# -p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£
[root@bovane java]# docker run -d --name="nginx-1" -p 3344:80 nginx
9358b6e211d57528d8484db8dfed95645e274a948c76ca69073b66df7f21c5b0
[root@bovane java]# docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES
9358b6e211d5   nginx     "/docker-entrypoint.â€¦"   15 seconds ago   Up 14 seconds   0.0.0.0:3344->80/tcp, :::3344->80/tcp   nginx-1
[root@bovane java]# docker exec 9358b6e211d5 -it /bin/bash
OCI runtime exec failed: exec failed: unable to start container process: exec: "-it": executable file not found in $PATH: unknown
[root@bovane java]# docker exec -it 9358b6e211d5 /bin/bash
root@9358b6e211d5:/# whereis nginx 
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
root@9358b6e211d5:/# cd /etc/nginx/
root@9358b6e211d5:/etc/nginx# ls
conf.d	fastcgi_params	mime.types  modules  nginx.conf  scgi_params  uwsgi_params
root@9358b6e211d5:/etc/nginx# 

```

æœ¬æœºæµ‹è¯•ï¼Œä½¿ç”¨curlçœ‹çœ‹:

```bash
[root@bovane ~]# curl localhost:3344
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>

```



å†å»å…¬ç½‘ï¼š3344å‘ç°ä¹Ÿå¯ä»¥è®¿é—®

ç«¯å£æš´éœ²ï¼š

![image-20231114192142619](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311141921132.png)

æ€è€ƒé—®é¢˜ï¼šæˆ‘ä»¬æ¯æ¬¡æ”¹åŠ¨nginxé…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Ÿååˆ†çš„éº»çƒ¦ï¼Œæˆ‘è¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œè¾¾åˆ°åœ¨å®¹å™¨å¤–ä¿®æ”¹æ–‡ä»¶åï¼Œå®¹å™¨å†…éƒ¨å°±å¯ä»¥è‡ªåŠ¨ä¿®æ”¹ï¼Ÿ-v æ•°æ®å·

### dockerå®‰è£…tomcat

```bash
# å®˜æ–¹çš„ä½¿ç”¨
docker run -it --rm tomcat
# æˆ‘ä»¬ä¹‹å‰çš„å¯åŠ¨éƒ½æ˜¯åå°ï¼Œåœæ­¢äº†å®¹å™¨ä¹‹åï¼Œå®¹å™¨è¿˜æ˜¯å¯ä»¥æŸ¥åˆ°docker run -it --rmï¼Œä¸€èˆ¬ç”¨æ¥æµ‹è¯•ï¼Œç”¨å®Œå°±åˆ é™¤ã€‚
# ä¸‹è½½
docker pull tomcat
# å¯åŠ¨è¿è¡Œ
docker run -d --name="tomcat01" -p 3344:8080 tomcat
# æµ‹è¯•è®¿é—®æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ‰¾ä¸åˆ°èµ„æº
# è¿›å…¥å®¹å™¨ï¼Œæœ‰ä¸€ä¸ªwebappsæ–‡ä»¶å¤¹å’Œwebapps.distæ–‡ä»¶å¤¹
docker exec -it tomcat01 /bin/bash
# webappsæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰èµ„æºï¼Œèµ„æºéƒ½åœ¨webapp.distæ–‡ä»¶å¤¹ä¸‹
[root@bovane ~]# docker run -d --name="tomcat01" -p 3344:80 tomcat
bfc960e371d1b4337246ca499db9714faf9c0440f29a4747cb24f81ac735b1ae
[root@bovane ~]# docker ps
CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                                             NAMES
bfc960e371d1   tomcat    "catalina.sh run"   12 seconds ago   Up 11 seconds   8080/tcp, 0.0.0.0:3344->80/tcp, :::3344->80/tcp   tomcat01
[root@bovane ~]# docker exec -it bfc960e371d1 /bin/bash
root@bfc960e371d1:/usr/local/tomcat# ls
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
root@bfc960e371d1:/usr/local/tomcat# ls webapps
root@bfc960e371d1:/usr/local/tomcat# cp -r webapps.dist/* webapps


# å‘ç°é—®é¢˜ï¼šï¼ˆé˜¿é‡Œäº‘é•œåƒçš„åŸå› ï¼šé»˜è®¤æ˜¯æœ€å°çš„é•œåƒï¼Œæ‰€æœ‰ä¸å¿…è¦çš„éƒ½å‰”é™¤æ‰ï¼‰ä¿è¯æœ€å°å¯è¿è¡Œçš„ç¯å¢ƒ
# 1ã€Linuxå‘½ä»¤å°‘äº†ã€‚
# 2ã€æ²¡æœ‰webappsæ–‡ä»¶å¤¹ã€‚
# æ²¡æœ‰webappsæ–‡ä»¶å¤¹ï¼Œå‘ç°æœ‰ä¸€ä¸ªwebapps.distæ–‡ä»¶å¤¹ï¼Œèµ„æºåœ¨webapps.distæ–‡ä»¶å¤¹ä¸‹ï¼›
# æŠŠwebapps.distæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°webappsæ–‡ä»¶å¤¹ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®æˆåŠŸã€‚
```

æˆ‘æ²¡æƒ³åˆ°è®¿é—®ä¸äº†ï¼Œå› ä¸ºæˆ‘ä¹‹å‰çš„é‚£ä¸ªç«¯å£æ²¡é‡Šæ”¾ï¼Œç„¶åæ¢äº†ä¸ªç«¯å£ï¼Œå‘ç°å®¹å™¨ä¸èƒ½åªæ˜¯åœæ­¢è¦å½»åº•rmæ‰èƒ½åœ¨å¯åŠ¨ï¼š

```bash
#rmæ‰€æœ‰å®¹å™¨ï¼Œstopä¾ç„¶å ç«¯å£ï¼
[root@bovane ~]# docker rm -f $(docker ps -aq) 
bfc960e371d1
9358b6e211d5
e383edfc6340
b8a5ed5d8d19
590c6000269d
[root@bovane ~]# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

[root@bovane ~]# docker run -d --name="tomcat01" -p 3355:8080 tomcat
31cdeb89ecef29e9910f1fcc6b6404c5d5f33df04598c1ea24472fde647253ab
[root@bovane ~]# docker ps
CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                                       NAMES
31cdeb89ecef   tomcat    "catalina.sh run"   25 seconds ago   Up 24 seconds   0.0.0.0:3355->8080/tcp, :::3355->8080/tcp   tomcat01
[root@bovane ~]# docker exec -it 31cdeb89ecef /bin/bash
root@31cdeb89ecef:/usr/local/tomcat# ls
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
root@31cdeb89ecef:/usr/local/tomcat# cp -r webapps.dist/* webapps
root@31cdeb89ecef:/usr/local/tomcat# 

```

ç»ˆäºæˆåŠŸè®¿é—®ï¼

![image-20231114194138263](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311141941247.png)

æ€è€ƒé—®é¢˜ï¼šæˆ‘ä»¬ä»¥åè¦éƒ¨ç½²é¡¹ç›®ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦è¿›å…¥å®¹å™¨æ˜¯ä¸æ˜¯ååˆ†éº»çƒ¦ï¼Ÿæˆ‘è¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œwebappsï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨æ”¾ç½®é¡¹ç›®ï¼Œå°±è‡ªåŠ¨åŒæ­¥åˆ°å†…éƒ¨å°±å¥½äº†ï¼

### éƒ¨ç½²ES+kibana

```bash
# esæš´éœ²çš„ç«¯å£å¾ˆå¤šï¼
# esååˆ†çš„è€—å†…å­˜ï¼
# esçš„æ•°æ®ä¸€èˆ¬éœ€è¦æ”¾ç½®åˆ°å®‰å…¨ç›®å½•ï¼æŒ‚è½½
# ä¸‹è½½å¯åŠ¨elasticsearch
docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.17.14
# å¯åŠ¨äº†linuxå°±å¡ä½äº†ï¼Œesæ˜¯ååˆ†è€—å†…å­˜çš„ï¼ˆ1æ ¸2Gï¼‰
# æŸ¥çœ‹cpuçš„çŠ¶æ€
docker stats 

# èµ¶ç´§å…³é—­ï¼Œå¢åŠ å†…å­˜çš„é™åˆ¶ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶-eç¯å¢ƒé…ç½®ä¿®æ”¹
docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmx512m" elasticsearch:7.17.14
# å¯ä»¥è®¿é—®æˆåŠŸï¼›æŸ¥çœ‹cpuçŠ¶æ€
docker stats 
#å‘ç°å çš„å†…å­˜å¾ˆå°ï¼Œå¯ä»¥ä¸å¡åœ°å¯åŠ¨äº†
```

![image-20231115132201731](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151322808.png)

ä½œä¸šï¼šä½¿ç”¨kibanaè¿æ¥esï¼Ÿæ€è€ƒç½‘ç»œå¦‚ä½•æ‰èƒ½è¿æ¥è¿‡å»ï¼

![image-20231115132634623](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151326517.png)

ç”±äºdockerå®¹å™¨ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œæ‰€ä»¥kibanaè‚¯å®šä¸èƒ½ç”¨localhostè¿åˆ°es

## 7. å¯è§†åŒ–

- portainerï¼ˆå…ˆç”¨è¿™ä¸ªï¼‰

```
docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer
```

- Rancherï¼ˆCI/CDæ—¶å†ç”¨è¿™ä¸ªï¼‰

### ä»€ä¹ˆæ˜¯portainer ?

Dockerå›¾å½¢åŒ–ç•Œé¢ç®¡ç†å·¥å…·ï¼æä¾›ä¸€ä¸ªåå°é¢æ¿ä¾›æˆ‘ä»¬æ“ä½œï¼

```bash
# å¯åŠ¨è¿è¡Œ
docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer
```

è®¿é—®æµ‹è¯•ï¼šå¤–ç½‘ï¼š8088

![image-20231115133423625](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151334491.png)

æ³¨å†Œè¿›å»ä¹‹åå‘¢é€‰æ‹©æœ¬åœ°è¿æ¥

# å››ã€Dockeré•œåƒè®²è§£

## 1. é•œåƒæ˜¯ä»€ä¹ˆ

é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚
æ‰€æœ‰çš„åº”ç”¨ï¼Œç›´æ¥æ‰“åŒ…dockeré•œåƒï¼Œå°±å¯ä»¥ç›´æ¥è·‘èµ·æ¥ï¼
å¦‚ä½•å¾—åˆ°é•œåƒï¼š

- ä»è¿œç¨‹ä»“åº“ä¸‹è½½
- æœ‹å‹æ‹·è´ç»™ä½ 
- è‡ªå·±åˆ¶ä½œä¸€ä¸ªé•œåƒDockerFile

## 2. Dockeré•œåƒåŠ é€ŸåŸç†

### UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰

æˆ‘ä»¬ä¸‹è½½çš„æ—¶å€™çœ‹åˆ°çš„ä¸€å±‚å±‚å°±æ˜¯è¿™ä¸ªï¼
UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ï¼ˆunite several directories into a single virtual filesystemï¼‰ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯Docker é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚

ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•ã€‚



### Dockeré•œåƒåŠ è½½åŸå‹

dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFSã€‚

bootfsï¼ˆboot file systemï¼‰ä¸»è¦åŒ…å«bootloaderå’Œkernelï¼Œbootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernelï¼ŒLinuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯bootfsã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½bootfsã€‚

rootfsï¼ˆroot file systemï¼‰ï¼Œåœ¨bootfsä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹Linuxç³»ç»Ÿä¸­çš„/devï¼Œ/procï¼Œ/binï¼Œ/etcç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚
rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntuï¼ŒCentosç­‰ç­‰ã€‚

![image-20231115134039921](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151340962.png)

å¹³æ—¶æˆ‘ä»¬å®‰è£…è¿›è™šæ‹Ÿæœºçš„CentOSéƒ½æ˜¯å¥½å‡ ä¸ªGï¼Œä¸ºä»€ä¹ˆDockerè¿™é‡Œæ‰200Mï¼Ÿ

å¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…å«æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œå·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±å¯ä»¥äº†ã€‚
ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„linuxå‘è¡Œç‰ˆï¼ŒbootfsåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œrootfsä¼šæœ‰å·®åˆ«ï¼Œå› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfsã€‚
ï¼ˆè™šæ‹Ÿæœºæ˜¯åˆ†é’Ÿçº§ï¼Œå®¹å™¨æ˜¯ç§’çº§ï¼ï¼‰

## 3. åˆ†å±‚ç†è§£

### åˆ†å±‚çš„é•œåƒ

æˆ‘ä»¬å¯ä»¥å»ä¸‹è½½ä¸€ä¸ªé•œåƒï¼Œæ³¨æ„è§‚å¯Ÿä¸‹è½½çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€å±‚ä¸€å±‚çš„åœ¨ä¸‹è½½ï¼

æ€è€ƒï¼šä¸ºä»€ä¹ˆDockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚çš„ç»“æ„å‘¢ï¼Ÿ
æœ€å¤§çš„å¥½å¤„ï¼Œæˆ‘è§‰å¾—è«è¿‡äºæ˜¯èµ„æºå…±äº«äº†ï¼æ¯”å¦‚æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„Baseé•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆå®¿ä¸»æœºåªéœ€åœ¨ç£ç›˜ä¸Šä¿ç•™ä¸€ä»½baseé•œåƒï¼ŒåŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€è¦åŠ è½½ä¸€ä»½baseé•œåƒï¼Œè¿™æ ·å°±å¯ä»¥ä¸ºæ‰€æœ‰çš„å®¹å™¨æœåŠ¡äº†ï¼Œè€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚
æŸ¥çœ‹é•œåƒåˆ†å±‚çš„æ–¹å¼å¯ä»¥é€šè¿‡ docker image inspectå‘½ä»¤ï¼

```bash
[
        // ......
        "RootFS": {
            "Type": "layers",
            "Layers": [
                "sha256:2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f",
                "sha256:9b24afeb7c2f21e50a686ead025823cd2c6e9730c013ca77ad5f115c079b57cb",
                "sha256:4b8e2801e0f956a4220c32e2c8b0a590e6f9bd2420ec65453685246b82766ea1",
                "sha256:529cdb636f61e95ab91a62a51526a84fd7314d6aab0d414040796150b4522372",
                "sha256:9975392591f2777d6bf4d9919ad1b2c9afa12f9a9b4d260f45025ec3cc9b18ed",
                "sha256:8e5669d8329116b8444b9bbb1663dda568ede12d3dbcce950199b582f6e94952"
            ]
        },
        "Metadata": {
            "LastTagTime": "0001-01-01T00:00:00Z"
        }
    }
]
```

**ç†è§£ï¼š**
æ‰€æœ‰çš„Docker é•œåƒéƒ½èµ·å§‹äºä¸€ä¸ªåŸºç¡€é•œåƒå±‚ï¼Œå½“è¿›è¡Œä¿®æ”¹æˆ–å¢åŠ æ–°çš„å†…å®¹æ—¶ï¼Œå°±ä¼šåœ¨å½“å‰é•œåƒå±‚ä¹‹ä¸Šï¼Œåˆ›å»ºæ–°çš„é•œåƒå±‚ã€‚
ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡å¦‚åŸºäºUbuntu Linux 16.04åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œè¿™å°±æ˜¯æ–°é•œåƒçš„ç¬¬ä¸€å±‚ï¼›å¦‚æœåœ¨è¯¥é•œåƒä¸­æ·»åŠ PythonåŒ…ï¼Œå°±ä¼šåœ¨åŸºç¡€é•œåƒå±‚ä¹‹ä¸Šåˆ›å»ºç¬¬äºŒä¸ªé•œåƒå±‚ï¼›å¦‚æœç»§ç»­æ·»åŠ ä¸€ä¸ªå®‰å…¨è¡¥ä¸ï¼Œå°±ä¼šåˆ›å»ºç¬¬ä¸‰ä¸ªé•œåƒå±‚ã€‚
è¯¥é•œåƒå½“å‰å·²ç»åŒ…å«3ä¸ªé•œåƒå±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆè¿™åªæ˜¯ä¸€ä¸ªç”¨äºæ¼”ç¤ºçš„å¾ˆç®€å•çš„ä¾‹å­ï¼‰ã€‚

![image-20231115134323687](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151343532.png)

åœ¨æ·»åŠ é¢å¤–çš„é•œåƒå±‚çš„åŒæ—¶ï¼Œé•œåƒå§‹ç»ˆä¿æŒæ˜¯å½“å‰æ‰€æœ‰é•œåƒçš„ç»„åˆï¼Œç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ä¸‹å›¾ä¸­ä¸¾äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯ä¸ªé•œåƒå±‚åŒ…å«3ä¸ªæ–‡ä»¶ï¼Œè€Œé•œåƒåŒ…å«äº†æ¥è‡ªä¸¤ä¸ªé•œåƒå±‚çš„6ä¸ªæ–‡ä»¶ã€‚

![image-20231115134445865](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151344983.png)

ä¸Šå›¾ä¸­çš„é•œåƒå±‚è·Ÿä¹‹å‰å›¾ä¸­çš„ç•¥æœ‰åŒºåˆ«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¾¿äºå±•ç¤ºæ–‡ä»¶ã€‚
ä¸‹å›¾ä¸­å±•ç¤ºäº†ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¸‰å±‚é•œåƒï¼Œåœ¨å¤–éƒ¨çœ‹æ¥æ•´ä¸ªé•œåƒåªæœ‰6ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸ºæœ€ä¸Šå±‚ä¸­çš„æ–‡ä»¶7æ˜¯æ–‡ä»¶5çš„ä¸€ä¸ªæ›´æ–°ç‰ˆæœ¬ã€‚

![image-20231115134433421](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151344770.png)

è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šå±‚é•œåƒå±‚ä¸­çš„æ–‡ä»¶è¦†ç›–äº†åº•å±‚é•œåƒå±‚ä¸­çš„æ–‡ä»¶ã€‚è¿™æ ·å°±ä½¿å¾—æ–‡ä»¶çš„æ›´æ–°ç‰ˆæœ¬ä½œä¸ºä¸€ä¸ªæ–°é•œåƒå±‚æ·»åŠ åˆ°é•œåƒå½“ä¸­ã€‚
Dockeré€šè¿‡å­˜å‚¨å¼•æ“ï¼ˆæ–°ç‰ˆæœ¬é‡‡ç”¨å¿«ç…§æœºåˆ¶ï¼‰çš„æ–¹å¼æ¥å®ç°é•œåƒå±‚å †æ ˆï¼Œå¹¶ä¿è¯å¤šé•œåƒå±‚å¯¹å¤–å±•ç¤ºä¸ºç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿã€‚
Linuxä¸Šå¯ç”¨çš„å­˜å‚¨å¼•æ“æœ‰AUFSã€Overlay2ã€Device Mapperã€Btrfsä»¥åŠZFSã€‚é¡¾åæ€ä¹‰ï¼Œæ¯ç§å­˜å‚¨å¼•æ“éƒ½åŸºäºLinuxä¸­å¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿæˆ–è€…å—è®¾å¤‡æŠ€æœ¯ï¼Œå¹¶ä¸”æ¯ç§å­˜å‚¨å¼•æ“éƒ½æœ‰å…¶ç‹¬æœ‰çš„æ€§èƒ½ç‰¹ç‚¹ã€‚
Dockeråœ¨Windows ä¸Šä»…æ”¯æŒ windowsfilterä¸€ç§å­˜å‚¨å¼•æ“ï¼Œè¯¥å¼•æ“åŸºäºNTFSæ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šå®ç°äº†åˆ†å±‚å’ŒCoW[1]ã€‚
ä¸‹å›¾å±•ç¤ºäº†ä¸ç³»ç»Ÿæ˜¾ç¤ºç›¸åŒçš„ä¸‰å±‚é•œåƒã€‚æ‰€æœ‰é•œåƒå±‚å †å å¹¶åˆå¹¶ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„è§†å›¾ã€‚

### ç‰¹ç‚¹

Dockeré•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼
è¿™ä¸€å±‚å°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„å®¹å™¨å±‚ï¼Œå®¹å™¨ä¹‹ä¸‹çš„éƒ½å«é•œåƒå±‚ï¼

![image-20231115134549497](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151345262.png)

## 4. commité•œåƒ

```bash
# æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬
docker commit
# å‘½ä»¤å’ŒgitåŸç†ç±»ä¼¼
docker commit -m="æäº¤çš„æè¿°ä¿¡æ¯" -a="ä½œè€…" å®¹å™¨id ç›®æ ‡é•œåƒå:[TAG]
```

### å®æˆ˜æµ‹è¯•

```bash
# 1.å¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„tomcatã€‚
# 2.å‘ç°è¿™ä¸ªé»˜è®¤çš„tomcatæ˜¯æ²¡æœ‰webappsåº”ç”¨ï¼Œé•œåƒçš„åŸå› ï¼Œå®˜æ–¹çš„é•œåƒé»˜è®¤webappsä¸‹é¢æ˜¯æ²¡æœ‰æ–‡ä»¶çš„ã€‚
# 3.æˆ‘è‡ªå·±æ‹·è´è¿›å»äº†åŸºæœ¬çš„æ–‡ä»¶ã€‚
# 4.å°†æˆ‘ä»¬æ“ä½œè¿‡çš„å®¹å™¨é€šè¿‡commitæäº¤ä¸ºä¸€ä¸ªé•œåƒï¼æˆ‘ä»¬ä»¥åå°±ä½¿ç”¨æˆ‘ä»¬ä¿®æ”¹è¿‡çš„é•œåƒå³å¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä¸€ä¸ªä¿®æ”¹çš„é•œåƒã€‚
```

```bash
[root@bovane ~]# docker commit -a="bovane" -m="add webapps app" 71bc69b043bc tomcat02:1.0
sha256:5e4bdbf82829238c08165c2fcca95901e1df581854fb606df45e077c3f00c93c
[root@bovane ~]# docker images
REPOSITORY            TAG       IMAGE ID       CREATED          SIZE
tomcat02              1.0       5e4bdbf82829   14 seconds ago   684MB

```

æäº¤é•œåƒæˆåŠŸï¼

å­¦ä¹ æ–¹å¼è¯´æ˜ï¼šç†è§£æ¦‚å¿µï¼Œä½†æ˜¯ä¸€å®šè¦å®è·µï¼Œæœ€åå®è·µå’Œç†è®ºç›¸ç»“åˆä¸€æ¬¡æå®šè¿™ä¸ªçŸ¥è¯†

:warning:***å¦‚æœä½ æƒ³è¦ä¿å­˜å½“å‰å®¹å™¨çš„çŠ¶æ€ï¼Œå°±å¯ä»¥é€šè¿‡commitæ¥æäº¤ï¼Œè·å¾—ä¸€ä¸ªé•œåƒï¼Œå°±å¥½æ¯”æˆ‘ä»¬ä»¥å‰å­¦ä¹ VMæ—¶å€™ï¼Œå¿«ç…§ï¼åˆ°äº†è¿™é‡Œæ‰ç®—æ˜¯å…¥é—¨Dokcerï¼***



# äº”ã€å®¹å™¨æ•°æ®å·(é‡ç‚¹)

## 1. ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·

**dockerçš„ç†å¿µå›é¡¾**
å°†åº”ç”¨å’Œç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ªé•œåƒï¼
æ•°æ®ï¼Ÿå¦‚æœæ•°æ®éƒ½åœ¨å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®¹å™¨åˆ é™¤ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ï¼ï¼ˆéœ€æ±‚ï¼šæ•°æ®å¯ä»¥æŒä¹…åŒ–ï¼‰
MySQLï¼Œå®¹å™¨åˆ äº†ï¼Œåˆ åº“è·‘è·¯ï¼ï¼ˆéœ€æ±‚ï¼šMySQLæ•°æ®å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ï¼‰
å®¹å™¨ä¹‹é—´å¯ä»¥æœ‰ä¸€ä¸ªæ•°æ®å…±äº«çš„æŠ€æœ¯ï¼Dockerå®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ï¼
è¿™å°±æ˜¯å·æŠ€æœ¯ï¼ç›®å½•çš„æŒ‚è½½ï¼Œå°†æˆ‘ä»¬å®¹å™¨å†…çš„ç›®å½•ï¼ŒæŒ‚è½½åˆ°Linuxä¸»æœºä¸Šé¢ï¼

![image-20231115140047571](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151400598.png)

æ€»ç»“ä¸€å¥è¯ï¼šå®¹å™¨çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œï¼å®¹å™¨é—´ä¹Ÿæ˜¯å¯ä»¥æ•°æ®å…±äº«çš„ï¼

## 2. ä½¿ç”¨æ•°æ®å·

### ç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥æŒ‚è½½ï¼š-v

```bash
docker run -it -v ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½• é•œåƒå /bin/bash
# æµ‹è¯•ï¼ŒæŸ¥çœ‹å®¹å™¨ä¿¡æ¯
docker inspect å®¹å™¨id
```

![image-20231115140417306](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151404172.png)

æµ‹è¯•æ–‡ä»¶çš„åŒæ­¥ï¼š
åœ¨å®¹å™¨çš„/homeæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºtest.javaæ–‡ä»¶ï¼Œä¼šåŒæ­¥åˆ°ä¸»æœºçš„/home/ceshiæ–‡ä»¶å¤¹ä¸‹ã€‚
`åˆ é™¤æ“ä½œä¹Ÿæ˜¯åŒæ­¥çš„ï¼›åŒå‘ç»‘å®šï¼Œä¿è¯ä¸¤è¾¹æ–‡ä»¶å¤¹ä¸‹çš„æ•°æ®å§‹ç»ˆæ˜¯ä¸€ç›´çš„ã€‚`

## å®æˆ˜ï¼šå®‰è£…mysql

```bash
# è·å–é•œåƒ
docker pull mysql:5.7
# è¿è¡Œå®¹å™¨ï¼Œéœ€è¦åšæ•°æ®ç›®å½•æŒ‚è½½ã€‚ï¼ˆå®‰è£…å¯åŠ¨mysqlï¼Œæ³¨æ„ï¼šéœ€è¦é…ç½®å¯†ç ï¼‰
# å®˜æ–¹å¯åŠ¨mysql
docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
# æˆ‘ä»¬å¯åŠ¨mysqlï¼ˆ-eæ˜¯ç¯å¢ƒé…ç½®ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -p 7777:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7
# å¯åŠ¨æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨navicatæ¥æ¥æµ‹è¯•ä¸€ä¸‹ã€‚
# navicatè¿æ¥åˆ°æœåŠ¡å™¨çš„7777ç«¯å£å’Œå®¹å™¨å†…çš„3306æ˜ å°„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è¿æ¥ä¸Šäº†ï¼
# åœ¨æœ¬åœ°æµ‹è¯•åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æ˜ å°„çš„è·¯å¾„æ˜¯å¦okï¼ï¼ˆOKçš„ï¼‰
```

## 4. åŒ¿åå’Œå…·åæŒ‚è½½

```bash
# åŒ¿åæŒ‚è½½
docker run -d -p --name nginx01 -v /etc/nginx nginx
# æŸ¥çœ‹æ‰€æœ‰çš„volumeçš„æƒ…å†µ
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker volume ls
DRIVER    VOLUME NAME
local     964b8e505f12f65fb23fd21f05cfa9ecd6c2c6b2ca89c0e44f168bb017dfabd6
# è¿™ç§å°±æ˜¯åŒ¿åæŒ‚è½½ï¼šæˆ‘ä»¬åœ¨-væŒ‚è½½ç›®å½•æ—¶ï¼Œåªå†™äº†å®¹å™¨å†…çš„è·¯å¾„ï¼Œæ²¡æœ‰å†™å®¹å™¨å¤–çš„è·¯å¾„ã€‚
# å…·åæŒ‚è½½
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -p 3344:80 --name nginx02 -v juming-nginx:/etc/nginx nginx
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker volume ls
DRIVER    VOLUME NAME
local     964b8e505f12f65fb23fd21f05cfa9ecd6c2c6b2ca89c0e44f168bb017dfabd6
local     juming-nginx
# é€šè¿‡ -v å·å:å®¹å™¨å†…çš„è·¯å¾„ï¼ˆå…·åæŒ‚è½½ï¼‰
# æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå·
```

æ‰€æœ‰çš„dockerå®¹å™¨å†…çš„å·ï¼Œæ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹éƒ½æ˜¯åœ¨`/var/lib/docker/volumes/xxxx/_data"`ï¼ˆxxxxæ˜¯å·åï¼‰
æˆ‘ä»¬é€šè¿‡å…·åæŒ‚è½½å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°æˆ‘ä»¬çš„ä¸€ä¸ªå·ï¼Œ`å¤§å¤šæ•°æƒ…å†µåœ¨ä½¿ç”¨çš„å…·åæŒ‚è½½`

```bash
# å¦‚ä½•ç¡®å®šæ˜¯å…·åæŒ‚è½½ï¼Œè¿˜æ˜¯åŒ¿åæŒ‚è½½ï¼Œè¿˜æ˜¯æŒ‡å®šè·¯å¾„æŒ‚è½½
-v å®¹å™¨å†…çš„è·¯å¾„                # åŒ¿åæŒ‚è½½
-v å·å:å®¹å™¨å†…çš„è·¯å¾„        # å…·åæŒ‚è½½
-v /å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„    # æŒ‡å®šè·¯å¾„æŒ‚è½½
```

æ‹“å±•ï¼š

```bash
# é€šè¿‡ -v å®¹å™¨å†…çš„è·¯å¾„:ro    rw    æ”¹å˜è¯»å†™æƒé™
ro    read only    # åªè¯»
rw    read write    # å¯è¯»å¯å†™
# ä¸€æ—¦è®¾ç½®äº†å®¹å™¨æƒé™ï¼Œå®¹å™¨å¯¹æˆ‘ä»¬æŒ‚è½½å‡ºæ¥çš„å†…å®¹å°±æœ‰äº†é™å®šã€‚
docker run -d -p 3344:80 --name nginx02 -v juming-nginx:/etc/nginx:ro nginx
docker run -d -p 3344:80 --name nginx02 -v juming-nginx:/etc/nginx:rw nginx
# åªè¦çœ‹åˆ°roå°±è¯´æ˜è¿™ä¸ªè·¯å¾„åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œï¼Œå®¹å™¨å†…éƒ¨æ˜¯æ— æ³•æ“ä½œï¼
```

## 5. åˆè¯†Dockerfile

Dockerfileå°±æ˜¯ç”¨æ¥æ„å»º docker é•œåƒçš„æ„å»ºå‘½ä»¤ï¼å‘½ä»¤è„šæœ¬ï¼å…ˆä½“éªŒä¸€ä¸‹ï¼
é€šè¿‡è¿™ä¸ªè„šæœ¬å¯ä»¥ç”Ÿæˆé•œåƒï¼Œé•œåƒæ˜¯ä¸€å±‚ä¸€å±‚çš„ï¼Œè„šæœ¬ä¸€ä¸ªä¸€ä¸ªçš„å‘½ä»¤ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸€å±‚ï¼

```bash
# åˆ›å»ºä¸€ä¸ªdockerfileæ–‡ä»¶ï¼Œåå­—å¯ä»¥éšæœºï¼Œå»ºè®®dockerfile
# æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šæŒ‡ä»¤éƒ½æ˜¯å¤§å†™
FROM centos							
VOLUME ["volume01","volume02"]        //åŒ¿åæŒ‚è½½ï¼Œrunçš„æ—¶å€™ä¼šç”Ÿæˆ
CMD echo "-----end-----"
CMD /bin/bash
# è¿™é‡Œçš„æ¯ä¸ªå‘½ä»¤ï¼Œå°±æ˜¯é•œåƒçš„ä¸€å±‚ã€‚ï¼ˆå‰é¢çš„åˆ†å±‚ç†è§£ï¼‰
```

æµ‹è¯•ï¼š

```bash
# ä¸€å®šæ³¨æ„å‘½ä»¤åé¢çš„ç‚¹
[root@bovane docker-test-volume]# docker build -f /home/docker-test-volume/Dockerfile1 -t bovane/centos:1.0 .
# é•œåƒå      :tag                                           /dockerfileè·¯å¾„
[+] Building 0.2s (5/5) FINISHED                                                                                                docker:default
 => [internal] load build definition from Dockerfile1                                                                                     0.1s
 => => transferring dockerfile: 117B                                                                                                      0.0s
 => [internal] load .dockerignore                                                                                                         0.1s
 => => transferring context: 2B                                                                                                           0.0s
 => [internal] load metadata for docker.io/library/centos:latest                                                                          0.0s
 => [1/1] FROM docker.io/library/centos                                                                                                   0.0s
 => exporting to image                                                                                                                    0.0s
 => => exporting layers                                                                                                                   0.0s
 => => writing image sha256:aa207a7e7dcdba4001d6ba2d66f1a62c98285412f6cf27b47d254cc9fc32729d                                              0.0s
 => => naming to docker.io/bovane/centos:1.0  
```

å¯åŠ¨ä¸€ä¸‹è‡ªå·±çš„é•œåƒå®¹å™¨ï¼Œæ³¨æ„è¿™é‡Œè¦ç”¨imageidå¯åŠ¨ä¸èƒ½ç”¨nameå¯åŠ¨ä¸ç„¶æ‰¾ä¸åˆ°ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆ

åæ¥çŸ¥é“ä¸ºä»€ä¹ˆäº†ï¼›æˆ‘ä»¬åˆ›å»ºçš„æ—¶å€™å†™äº†ç‰ˆæœ¬ï¼Œæ‰€ä»¥runçš„æ—¶å€™å¿…é¡»å¸¦ä¸Šç‰ˆæœ¬ï¼Œå¦‚æœæ„å»ºæ—¶æ²¡å†™ç‰ˆæœ¬é»˜è®¤æœ€æ–°æ‰€ä»¥ä¸ç”¨å¸¦ç‰ˆæœ¬

![image-20231115175128009](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151751823.png)

ä¼šå‘ç°é‡Œé¢æœ‰ä¸¤ä¸ªvolume1å’Œvolume2è¿™å°±æ˜¯æˆ‘ä»¬åœ¨dockerfileé‡Œå†™çš„æŒ‚è½½ï¼Œè¿™ä¸ªå·å’Œå¤–éƒ¨ä¸€å®šæœ‰ä¸€ä¸ªåŒæ­¥çš„ç›®å½•ï¼

æŸ¥çœ‹ä¸€ä¸‹å·æŒ‚è½½çš„è·¯å¾„ï¼šdocker inspect å®¹å™¨idï¼š

![image-20231115182657877](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151826909.png)

ç”±äºæ˜¯åŒ¿åæŒ‚è½½ï¼Œä¸ºä¸¤ä¸²ä¹±ç 
`è¿™ç§æ–¹å¼æˆ‘ä»¬æœªæ¥ä½¿ç”¨çš„ååˆ†å¤šï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸ä¼šæ„å»ºè‡ªå·±çš„é•œåƒï¼`
å¦‚æœæ„å»ºé•œåƒæ—¶å€™æ²¡æœ‰æŒ‚è½½å·ï¼Œå°±éœ€è¦è‡ªå·±æ‰‹åŠ¨é•œåƒæŒ‚è½½ç›®å½•ï¼

## 6. æ•°æ®å·å®¹å™¨

å¤šä¸ªå®¹å™¨åŒæ­¥æ•°æ®

![image-20231115183043700](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151830700.png)

å¯åŠ¨ä¸‰ä¸ªå®¹å™¨ï¼Œ**é•œåƒæ˜¯åŒä¸€ä¸ª**ï¼Œå¹¶ä¸”åœ¨æ„å»ºæ—¶æœ‰æŒ‚è½½å·ï¼Œä»¥bovane/centos:1.0 .ä¸ºä¾‹

```shell
docker run -it --name docker02 --volumes-from docker01 bovane/centos:1.0
```

åˆ™ä¸¤ä¸ªå®¹å™¨çš„volume1å’Œ2å®ç°äº†åŒæ­¥

è¿™æ—¶å¦‚æœæœ‰ä¸ªdocker03 volumes-form docker02ï¼Œä¹Ÿå¯ä»¥å…±äº«

```bash
# æµ‹è¯•ï¼šå¯ä»¥åˆ é™¤docker01ï¼ŒæŸ¥çœ‹ä¸€ä¸‹docker02å’Œdocker03æ˜¯å¦è¿˜å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶
# æµ‹è¯•ä¾æ—§å¯ä»¥è®¿é—®
```

# å…­ã€DockerFile

## 1. DockerFileä»‹ç»

dockerfileæ˜¯ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ–‡ä»¶ï¼å‘½ä»¤å‚æ•°è„šæœ¬ï¼
æ„å»ºæ­¥éª¤ï¼š
1ã€ç¼–å†™ä¸€ä¸ªdockerfileæ–‡ä»¶
2ã€docker build æ„å»ºæˆä¸ºä¸€ä¸ªé•œåƒ
3ã€docker runè¿è¡Œé•œåƒ
4ã€docker pushå‘å¸ƒé•œåƒï¼ˆDockerHubã€é˜¿é‡Œäº‘é•œåƒä»“åº“ï¼ï¼‰
æŸ¥çœ‹ä¸€ä¸‹å®˜æ–¹æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

ä»DockerHubé€‰ä¸€ä¸ªç‰ˆæœ¬ç‚¹å¼€åˆ°githubæŸ¥çœ‹æ˜¯ä¸€ä¸ªdockerfile

![image-20231115185500279](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151855040.png)

## 2. DockerFileçš„æ„å»ºè¿‡ç¨‹

### åŸºç¡€çŸ¥è¯†

1ã€æ¯ä¸ªä¿ç•™å…³é”®å­—ï¼ˆæŒ‡ä»¤ï¼‰éƒ½æ˜¯å¿…é¡»æ˜¯å¤§å†™å­—æ¯
2ã€æ‰§è¡Œä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ
3ã€# è¡¨ç¤ºæ³¨é‡Š
4ã€æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¹¶æäº¤ï¼

![image-20231115185742790](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151857852.png)

dockerfileæ˜¯é¢å‘å¼€å‘çš„ï¼Œæˆ‘ä»¬ä»¥åè¦å‘å¸ƒé¡¹ç›®ï¼Œåšé•œåƒï¼Œå°±éœ€è¦ç¼–å†™dockerfileæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ååˆ†ç®€å•ï¼
Dockeré•œåƒé€æ¸æˆä¸ºä¼ä¸šäº¤ä»˜çš„æ ‡å‡†ï¼Œå¿…é¡»è¦æŒæ¡ï¼
æ­¥éª¤ï¼šå¼€å‘ï¼Œéƒ¨ç½²ï¼Œè¿ç»´ã€‚ã€‚ã€‚ç¼ºä¸€ä¸å¯ï¼|
DockerFileï¼šæ„å»ºæ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€åˆ‡çš„æ­¥éª¤ï¼Œæºä»£ç ã€‚
Dockerlmagesï¼šé€šè¿‡DockerFileæ„å»ºç”Ÿæˆçš„é•œåƒï¼Œæœ€ç»ˆå‘å¸ƒå’Œè¿è¡Œçš„äº§å“ã€‚
Dockerå®¹å™¨ï¼šå®¹å™¨å°±æ˜¯é•œåƒè¿è¡Œèµ·æ¥æä¾›æœåŠ¡çš„ã€‚

## 3. DockerFileçš„å‘½ä»¤

ä»¥å‰çš„è¯æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨åˆ«äººçš„ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†è¿™äº›æŒ‡ä»¤åï¼Œæˆ‘ä»¬æ¥ç»ƒä¹ è‡ªå·±å†™ä¸€ä¸ªé•œåƒï¼

```bash
FROM        # åŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹æ„å»º
MAINTAINER    # é•œåƒæ˜¯è°å†™çš„ï¼šå§“å+é‚®ç®±
RUN            # é•œåƒæ„å»ºçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤
ADD            # æ­¥éª¤ï¼štomcaté•œåƒï¼Œè¿™ä¸ªtomcatå‹ç¼©åŒ…ï¼æ·»åŠ å†…å®¹
WORKDIR        # é•œåƒçš„å·¥ä½œç›®å½•
VOLUME        # æŒ‚è½½çš„ç›®å½•
EXPOSE        # æš´éœ²ç«¯å£é…ç½® "-p"
CMD            # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢«æ›¿ä»£
ENTRYPOINT    # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤
ONBUILD        # å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿DockerFileè¿™ä¸ªæ—¶å€™å°±ä¼šè¿è¡ŒONBUILDçš„æŒ‡ä»¤ã€‚è§¦å‘æŒ‡ä»¤ã€‚
COPY        # ç±»ä¼¼ADDï¼Œå°†æˆ‘ä»¬æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­
ENV            # æ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡ï¼
```

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudyd150327c-9e51-48ab-8867-dee808407452.jpg)

## 4. å®æˆ˜æµ‹è¯•

Docker Hubä¸­99%é•œåƒéƒ½æ˜¯ä»è¿™ä¸ªåŸºç¡€é•œåƒè¿‡æ¥çš„FROM scratchï¼Œç„¶åé…ç½®éœ€è¦çš„è½¯ä»¶å’Œé…ç½®æ¥è¿›è¡Œçš„æ„å»ºã€‚

```bash
# 1. ç¼–å†™dockerfileçš„æ–‡ä»¶
FROM centos:7
MAINTAINER sywl<xxx@qq.com>
ENV MYPATH /usr/local                        # æ„å»ºä¸€ä¸ªç¯å¢ƒå˜é‡
WORKDIR $MYPATH						         # å·¥ä½œç›®å½•
RUN yum -y install vim
RUN yum -y install net-tools
EXPOSE 80
CMD echo $MYPATH
CMD echo "-----end-----"
CMD /bin/bash
# 2. é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ„å»ºé•œåƒ
# å‘½ä»¤ï¼šdocker build -f dockerfileæ–‡ä»¶è·¯å¾„ -t é•œåƒå:[tag]
docker build -f mydockerfile-centos -t mycentos:0.1 .
Successfully built 285c2064af01
Successfully tagged mycentos:0.1
# 3. æµ‹è¯•è¿è¡Œ
```

è¿›å»å®¹å™¨ä¹‹åå¯¹æ¯”ï¼š
ä¹‹å‰çš„åŸç”Ÿçš„centos7ï¼š
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudy3e59f341-6850-445c-a1bc-330c574a781c.jpg)
æˆ‘ä»¬å¢åŠ ä¹‹åçš„é•œåƒï¼š
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudye10e7d39-2971-4e5e-ae7e-6646b3a97a35.jpg)

å·¥ä½œç›®å½•å˜äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€è¿›å»å°±è¿›åˆ°å·¥ä½œç›®å½•è€Œä¸æ˜¯æ ¹ç›®å½•ï¼Œvimä¹Ÿå¯ä»¥ä½¿ç”¨



æˆ‘ä»¬å¯ä»¥åˆ—å‡ºæœ¬åœ°è¿›è¡Œçš„å˜æ›´å†å²ï¼šdocker history é•œåƒid
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudy62d94e6e-5f92-4f5e-aa5b-be3574e4ac6b.jpg)

> CMDå’ŒENTRYPOINTåŒºåˆ«

```bash
CMD            # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢«æ›¿ä»£
ENTRYPOINT     # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤
```

è¿½åŠ æ˜¯æŒ‡åœ¨æ–‡ä»¶å¤–é¢è¿½åŠ ï¼æ¯”å¦‚åŠ ä¸€ä¸ª -l

## 5. åˆ¶ä½œtomcaté•œåƒ

1. å‡†å¤‡é•œåƒæ–‡ä»¶ï¼štomcatå‹ç¼©åŒ…ï¼Œjdkçš„å‹ç¼©åŒ…ï¼
   ![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudy3b8c3159-7579-42b9-99d7-8d10b48187e0.jpg)
2. ç¼–å†™dockerfileæ–‡ä»¶ï¼Œå®˜æ–¹å‘½å**Dockerfile**ï¼Œbuildä¼šè‡ªåŠ¨å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¸éœ€è¦-fæŒ‡å®šæ–‡ä»¶åäº†ï¼

```dockerfile
 FROM centos:7
 MAINTAINER sywl<xxxx@qq.com>
 COPY readme.txt /usr/local/readme.txt
 ADD jdk-8u271-linux-x64.tar.gz /usr/local/
 ADD apache-tomcat-9.0.5.tar.gz /usr/local/
 RUN yum -y install vim
 ENV MYPATH /usr/local
 WORKDIR $MYPATH
 ENV JAVA_HOME /usr/local/jdk1.8.0_271
 ENV CLASS_PATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
 ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.5
 ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.5
 ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin
 EXPOSE 8080
 CMD /usr/local/apache-tomcat-9.0.5/bin/startup.sh && tail -F /usr/local/apache-tomcat-9.0.5/bin/logs/catalina.out
```

1. æ„å»ºé•œåƒ

   ```bash
   docker build --name diytomcat .
   ```

2. å¯åŠ¨é•œåƒ

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ tomcat]# docker run -d -p 3355:8080 --name sywltomcat -v /home/sywl/build/tomcat/test:/usr/local/apache-tomcat-9.0.5/webapps/test -v /home/sywl/build/tomcat/tomcatlog:/usr/local/apache-tomcat-9.0.5/logs diytomcat
```

1. è®¿é—®æµ‹è¯•
   ![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/03/kuangstudyb6900457-27f2-448e-be54-6069b4f9783f.jpg)
2. å‘å¸ƒé¡¹ç›®ï¼ˆç”±äºåšäº†å·æŒ‚è½½ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æœ¬åœ°testæ–‡ä»¶å¤¹ä¸‹ç¼–å†™é¡¹ç›®å°±å¯ä»¥å‘å¸ƒäº†ï¼ï¼‰

```xml
# /home/sywl/build/tomcat/test/WEB-INF/web.xmlæ–‡ä»¶
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://java.sun.com/xml/ns/javaee  http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
     version="2.5">
</web-app>
```

```xml
# /home/sywl/build/tomcat/test/index.jspæ–‡ä»¶
<%@ page language="java" contentType="text/html; charset=UTF-8"
 pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>hello,sywl</title>
</head>
<body>
Hello World!<br/>
<%
System.out.println("----my web test----");
%>
</body>
</html>
```

å‘ç°ï¼šé¡¹ç›®éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è®¿é—®okï¼ï¼ˆipåœ°å€:3355/testï¼‰
æˆ‘ä»¬ä»¥åå¼€å‘çš„æ­¥éª¤ï¼šéœ€è¦æŒæ¡Dokcerfileçš„ç¼–å†™ï¼æˆ‘ä»¬ä¹‹åçš„ä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨dockeré•œåƒæ¥å‘å¸ƒè¿è¡Œï¼

## 6. å‘å¸ƒè‡ªå·±çš„é•œåƒ

### 1. å‘å¸ƒåˆ°dockerhubä¸Š

1. https://hub.docker.com/ æ³¨å†Œè‡ªå·±çš„è´¦å·
2. ç¡®å®šè¿™ä¸ªè´¦å·å¯ä»¥ç™»å½•
3. åœ¨æˆ‘ä»¬æœåŠ¡å™¨ä¸Šæäº¤è‡ªå·±çš„é•œåƒ

```bash
[root@bovane ~]# docker login --help

Usage:  docker login [OPTIONS] [SERVER]

Log in to a registry.
If no server is specified, the default is defined by the daemon.

Options:
  -p, --password string   Password
      --password-stdin    Take the password from stdin
  -u, --username string   Username
[root@bovane ~]# docker login -u bovane777
Password: 
Error response from daemon: Get "https://registry-1.docker.io/v2/": unauthorized: incorrect username or password
[root@bovane ~]# docker login -u bovane777
Password: 
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
[root@bovane ~]# 

```

ç™»å½•å®Œæ¯•åå°±å¯ä»¥æäº¤é•œåƒäº†ï¼Œå°±æ˜¯ä¸€æ­¥ï¼š docker push

```bash
# pushé•œåƒå‡ºç°çš„é—®é¢˜ï¼Ÿ
 [root@bovane ~]# docker push bovane/centos:1.0
The push refers to repository [docker.io/bovane/centos]
74ddd0ec08fa: Preparing 
denied: requested access to the resource is denied
[root@bovane ~]# docker tag aa207a7e7dcd bovane777/centos:1.0
[root@bovane ~]# docker images
REPOSITORY            TAG       IMAGE ID       CREATED         SIZE
tomcat02              1.0       5e4bdbf82829   6 hours ago     684MB
elasticsearch         7.17.14   63bea68e1707   5 weeks ago     649MB
hello-world           latest    9c7a54a9a43c   6 months ago    13.3kB
nginx                 latest    605c77e624dd   22 months ago   141MB
tomcat                latest    fb5657adc892   23 months ago   680MB
mysql                 latest    3218b38490ce   23 months ago   516MB
bovane/centos         1.0       aa207a7e7dcd   2 years ago     231MB
bovane777/centos      1.0       aa207a7e7dcd   2 years ago     231MB
centos                latest    5d0da3dc9764   2 years ago     231MB
portainer/portainer   latest    580c0e4e98b0   2 years ago     79.1MB
[root@bovane ~]# docker push bovane777/centos:1.0
The push refers to repository [docker.io/bovane777/centos]

```

å°±æ˜¯ä¸€å®šå¾—æ˜¯ç”¨æˆ·å

![image-20231115194805438](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151948418.png)

## å°ç»“å’Œgithubå·®ä¸å¤š

![image-20231115194946681](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311151949836.png)

# ä¸ƒã€Dockerç½‘ç»œ

## 1. ç†è§£docker0

å…ˆæŠŠå®¹å™¨å’Œé•œåƒå…¨åˆ äº†ï¼Œè®¤çœŸå­¦ç½‘ç»œ

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudydee80493-070a-4d74-88b2-816d0bce1f3b.jpg)

æœ‰ä¸‰ä¸ªç½‘ç»œ

```
# é—®é¢˜ï¼šdockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿ
```

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy21a89436-12e0-4cad-947d-77eefb762997.jpg)

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -P --name tomcat01 tomcat
# æŸ¥çœ‹å®¹å™¨çš„å†…éƒ¨ç½‘ç»œåœ°å€ip addrï¼Œå‘ç°å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šå¾—åˆ°ä¸€ä¸ªeth0@if119çš„ipåœ°å€ï¼ˆdockeråˆ†é…çš„ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat01 ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
118: eth0@if119: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
# æ€è€ƒï¼šliunxèƒ½ä¸èƒ½pingé€šå®¹å™¨å†…éƒ¨ï¼Ÿï¼ˆlinuxå¯ä»¥pingé€šå®¹å™¨å†…éƒ¨ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.059 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.046 ms
64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.057 ms
64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.045 ms
```

### åŸç†

1. æˆ‘ä»¬æ¯å¯åŠ¨ä¸€ä¸ªdockerå®¹å™¨ï¼Œdockerå°±ä¼šç»™dockerå®¹å™¨åˆ†é…ä¸€ä¸ªipï¼Œæˆ‘ä»¬åªè¦å®‰è£…äº†ddckerï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç½‘å¡docker0
   ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼Œä½¿ç”¨çš„æŠ€æœ¯æ˜¯veth-pairæŠ€æœ¯ï¼‰
   å†æ¬¡æµ‹è¯•ï¼š

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy7134bffc-5262-4393-a6a0-42b27b89e906.png)

åœ¨å¯åŠ¨ä¸€ä¸ªå®¹å™¨æµ‹è¯•ï¼Œå‘ç°åˆå¤šäº†ä¸€å¯¹ç½‘å¡ã€‚
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudya5d90c2d-5be3-4c92-b72e-b8aa1f68324e.jpg)
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudye5aa04a0-d3fe-42a1-9143-ff5809597941.jpg)

```bash
# æˆ‘ä»¬å‘ç°è¿™ä¸ªå®¹å™¨å¸¦æ¥ç½‘å¡ï¼Œéƒ½æ˜¯ä¸€å¯¹å¯¹çš„ã€‚
# veth-pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œä»–ä»¬éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œä¸€ç«¯è¿ç€åè®®ï¼Œä¸€ç«¯å½¼æ­¤ç›¸è¿ã€‚
# æ­£å› ä¸ºæœ‰è¿™ä¸ªç‰¹æ€§ï¼Œevth-pairå……å½“ä¸€ä¸ªæ¡¥æ¢ï¼Œè¿æ¥å„ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„ã€‚
# openstackï¼ŒDockerå®¹å™¨ä¹‹é—´çš„è¿æ¥ï¼ŒOVSçš„è¿æ¥ï¼Œéƒ½æ˜¯ä½¿ç”¨veth-pairæŠ€æœ¯ã€‚
```

æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹tomcat01å’Œtomcat02æ˜¯å¦å¯ä»¥pingé€šï¼ï¼ˆå¯ä»¥pingé€šï¼‰

```bash
 [root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat02 ping 172.17.0.2
 PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
 64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.094 ms
 64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.055 ms
 # ç»“è®ºï¼šå®¹å™¨å’Œå®¹å™¨ä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸pingé€šçš„ï¼
```

1. ç»˜åˆ¶ä¸€ä¸ªç½‘ç»œæ¨¡å‹å›¾
   ![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudye5054f76-0675-4c98-a969-4d2826c95e10.jpg)
   ç»“è®ºï¼štomcat01å’Œtomcat02æ˜¯å…¬ç”¨çš„ä¸€ä¸ªè·¯ç”±å™¨ï¼Œ**docker0**!ã€‚
   æ‰€æœ‰çš„å®¹å™¨ä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯docker0è·¯ç”±çš„ï¼Œdockerä¼šç»™æˆ‘ä»¬çš„å®¹å™¨åˆ†é…ä¸€ä¸ªé»˜è®¤çš„å¯ç”¨IP

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy1a3f75b3-decf-4b88-9d35-c02d029c5f7d.jpg)
Dockerä¸­çš„æ‰€æœ‰çš„ç½‘ç»œæ¥å£éƒ½æ˜¯è™šæ‹Ÿçš„ã€‚è™šæ‹Ÿçš„è½¬å‘æ•ˆç‡é«˜ï¼ï¼ˆå†…ç½‘ä¼ é€’æ–‡ä»¶ï¼ï¼‰
åªè¦å®¹å™¨åˆ é™¤ï¼Œå¯¹åº”ç½‘æ¡¥ä¸€å¯¹å°±æ²¡äº†ï¼
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy0a4781e6-e272-4e1f-a184-ffe7d6ff1692.jpg)

## --link

> æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼ˆé«˜å¯ç”¨ï¼‰

æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå¾®æœåŠ¡ï¼Œdatabase url=ip:ï¼Œé¡¹ç›®ä¸é‡å¯ï¼Œæ¯æ¬¡ç”¨dockerå¯åŠ¨mybatisçš„æ—¶å€™ä¼šåˆ†é…ç»™å®¹å™¨æ–°çš„ç½‘å¡ä¸€å¯¹ï¼Œæ•°æ®åº“ipæ¢æ‰äº†ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åå­—æ¥è¿›è¡Œè®¿é—®å®¹å™¨ï¼Ÿ

```bash
# é€šè¿‡æœåŠ¡åpingä¸é€šï¼›å¦‚ä½•è§£å†³ï¼Ÿ
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat02 ping tomcat01
ping: tomcat01: Name or service not known
# é€šè¿‡--linkå¯ä»¥è§£å†³ç½‘ç»œè¿æ¥é—®é¢˜ã€‚
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat:7.0
2393eecb870e5755068ea8b7d8bdcdd0f1ff110534c3359384413677c651bec4
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat03 ping tomcat02
PING tomcat02 (172.17.0.3) 56(84) bytes of data.
64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.085 ms
64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.055 ms
# åå‘å¯ä»¥pingé€šå—ï¼Ÿï¼ˆä¸å¯ä»¥ï¼‰
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat02 ping tomcat03
ping: tomcat03: Name or service not known
```

æ¢ç©¶ï¼šdocker network inspect networkID (docker network lså¯ä»¥æŸ¥çœ‹networkID)
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudyb4c2cdd5-23f7-4cd0-bbdc-a6c843187c99.jpg)
å…¶å®è¿™ä¸ªtomcat03å°±æ˜¯åœ¨æœ¬åœ°é…ç½®äº†tomcat02çš„é…ç½®ï¼Ÿ

```bash
# æŸ¥çœ‹
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat03 cat /etc/hosts
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.3      tomcat02 20398a94efa7
172.17.0.4      2393eecb870e
```

æœ¬è´¨æ¢ç©¶ï¼šâ€”link å°±æ˜¯æˆ‘ä»¬åœ¨hostsé…ç½®ä¸­å¢åŠ äº†ä¸€ä¸ªâ€172.17.0.3 tomcat02 20398a94efa7â€
æˆ‘ä»¬ç°åœ¨ç©Dockerå·²ç»ä¸å»ºè®®ä½¿ç”¨â€”linkäº†ï¼
è‡ªå®šä¹‰ç½‘ç»œï¼ä¸ä½¿ç”¨docker0ï¼
docker0é—®é¢˜ï¼šä»–ä¸æ”¯æŒå®¹å™¨åè¿æ¥è®¿é—®ï¼

## 3. è‡ªå®šä¹‰ç½‘ç»œ

### æŸ¥çœ‹æ‰€æœ‰çš„dockerç½‘ç»œ

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudyaea52932-a8b4-413d-9176-e4902b77c55a.jpg)

### ç½‘ç»œæ¨¡å¼

bridgeï¼šæ¡¥æ¥ dockerï¼ˆé»˜è®¤ï¼Œè‡ªå·±åˆ›å»ºä¹Ÿä½¿ç”¨bridgeæ¡¥æ¥æ¨¡å¼ï¼‰
noneï¼šä¸é…ç½®ç½‘ç»œ
hostï¼šå’Œä¸»æœºå…±äº«ç½‘ç»œ
containerï¼šå®¹å™¨ç½‘ç»œè¿é€šï¼ï¼ˆç”¨çš„å°‘ï¼å±€é™å¾ˆå¤§ï¼‰

### æµ‹è¯•

```bash
# æˆ‘ä»¬ç›´æ¥å¯åŠ¨çš„å‘½ä»¤--net bridgeï¼ˆè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„docker0ï¼‰ï¼›é»˜è®¤å¸¦ä¸Šè¿™ä¸ªå‚æ•°çš„ï¼Œä»¥ä¸‹ä¸¤ç§å¯åŠ¨æ–¹å¼æ•ˆæœä¸€è‡´ã€‚
docker run -d -P --name tomcat01 tomcat
docker run -d -P --name tomcato1 --het bridge tomcat
# docker0ç‰¹ç‚¹ï¼šé»˜è®¤ï¼ŒåŸŸåä¸èƒ½è®¿é—®ï¼Œ--1inkå¯ä»¥æ‰“é€šè¿æ¥ï¼
# æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç½‘ç»œï¼
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
7254ffccbdf5   bridge    bridge    local
45610891738f   host      host      local
266acd66473c   mynet     bridge    local
7795cbc2686c   none      null      local
```

æˆ‘ä»¬è‡ªå·±çš„ç½‘ç»œå°±åˆ›å»ºå¥½äº†
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy5d3a6b5a-ff82-4bcb-9255-6755c473a5bd.jpg)
å¯åŠ¨ä¸¤ä¸ªå®¹å™¨æµ‹è¯•ï¼š

```bash
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -P --name tomcat-net-01 --net mynet tomcat:7.0
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker run -d -P --name tomcat-net-02 --net mynet tomcat:7.0
```

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy0973705a-9efc-453a-a1b8-9d9f544c0254.jpg)

```bash
# ä¸ä½¿ç”¨--linkï¼Œpingåå­—ä¹Ÿå¯ä»¥pingé€šã€‚tomcat-net-01 ping tomcat-net-02å¯ä»¥pingé€š
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat-net-01 ping tomcat-net-02
PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.
64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.067 ms
64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.056 ms
# ä¸ä½¿ç”¨--linkï¼Œpingåå­—ä¹Ÿå¯ä»¥pingé€šã€‚tomcat-net-02 ping tomcat-net-01å¯ä»¥pingé€š
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat-net-02 ping tomcat-net-01
PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.
64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.050 ms
64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.056 ms
```

æˆ‘ä»¬è‡ªå®šä¹‰çš„ç½‘ç»œdockeréƒ½å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤å¥½äº†å¯¹åº”çš„å…³ç³»ï¼Œ**æ¨èæˆ‘ä»¬å¹³æ—¶è¿™æ ·ä½¿ç”¨ç½‘ç»œ**ï¼
redis -ä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯é›†ç¾¤æ˜¯å®‰å…¨å’Œå¥åº·çš„
mysql -ä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯é›†ç¾¤æ˜¯å®‰å…¨å’Œå¥åº·çš„

## 4. ç½‘ç»œè¿é€š

```bash
# tomcat01åœ¨docker0ç½‘ç»œä¸‹ï¼Œtomcat-net-01åœ¨mynetç½‘ç»œä¸‹ï¼›
# tomcat01 ping tomcat-net-01æ˜¯pingä¸é€šçš„
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat01 ping tomcat-net-01
ping: tomcat-net-01: Name or service not known
```

å®¹å™¨å’Œmynetç½‘ç»œéœ€è¦æ‰“é€š
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy06b13128-bb64-478b-8f97-5aff19bc2536.jpg)
æ‰“é€šå‘½ä»¤
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudyec3a2bcc-43e6-4081-ae71-55e6c425c046.jpg)
![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudyd5ffaf3c-8422-4bc4-bd4e-69350ced4496.jpg)

```bash
# æµ‹è¯•ï¼šæ‰“é€štomcat01è¿æ¥mynet
docker network connect mynet tomcat01
# è¿é€šä¹‹åå°±æ˜¯å°†tomcat01æ”¾åˆ°äº†mynetç½‘ç»œä¸‹
# ä¸€ä¸ªå®¹å™¨ä¸¤ä¸ªipåœ°å€ï¼I
# é˜¿é‡Œäº‘æœåŠ¡ï¼šå…¬ç½‘ipå’Œç§ç½‘ip
```

![img](https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/08/04/kuangstudy08a7cb91-60d2-4d96-a468-a289267e8a12.jpg)

```bash
# è¿æ¥ok
[root@iZbp13qr3mm4ucsjumrlgqZ ~]# docker exec -it tomcat01 ping tomcat-net-01
PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.
64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.065 ms
64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.052 ms
```

ç»“è®ºï¼šå‡è®¾è¦è·¨ç½‘ç»œæ“ä½œåˆ«äººï¼Œå°±éœ€è¦ä½¿ç”¨docker network connectè¿é€šï¼ã€‚ã€‚ã€‚ã€‚



# å®æˆ˜ï¼šéƒ¨ç½²redisé›†ç¾¤

åˆ›å»ºredisçš„ç½‘å¡ï¼š

```bash
[root@bovane ~]# docker network create redis --subnet 172.38.0.0/16
2a85701413ed3e32f311ff25993b940a08bd686acbe34760c3adb69680fb53b6
[root@bovane ~]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
1591af137085   bridge    bridge    local
92f0d10270d8   host      host      local
806086b147c1   mynet     bridge    local
cbb8fdbb8030   none      null      local
2a85701413ed   redis     bridge    local
```

:warning:ç„¶åæ”¾åœ¨è¿™ï¼Œå»å­¦ä¸€ä¸‹redisé›†ç¾¤å†è¿‡æ¥ï¼



# Springå¾®æœåŠ¡æ‰“åŒ…åˆ›å»ºdockeré•œåƒ

1.æ„å»ºspringbooté¡¹ç›®

2.æ‰“åŒ…åº”ç”¨

3.ç¼–å†™dockerfile

4.æ„å»ºé•œåƒ

5.å‘å¸ƒè¿è¡Œ

ç°åœ¨æŠŠæˆ‘ä»¬çš„é¡¹ç›®éƒ¨ç½²åˆ°å®¹å™¨ä¸­è¿è¡Œ

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ DockerFileï¼š

```bash
[root@bovane idea]# ls
chatbot-api.jar  Dockerfile
[root@bovane idea]# vim Dockerfile 
[root@bovane idea]# ls
chatbot-api.jar  Dockerfile
[root@bovane idea]# cat Dockerfile 
FROM java:8

# ä½œè€…
MAINTAINER bovane777
# é…ç½®
ENV PARAMS=""
# æ—¶åŒº
ENV TZ=PRC
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# æ·»åŠ åº”ç”¨
ADD Chatbot-api.jar /app/

EXPOSE 8090
# æ‰§è¡Œé•œåƒï¼›docker run -e PARAMS=" --chatbot-api.groupId=ä½ çš„æ˜ŸçƒID --chatbot-api.openAiKey=è‡ªè¡Œç”³è¯· --chatbot-api.cookie=ç™»å½•cookieä¿¡æ¯" -p 8090:8090 --name chatbot-api -d chatbot-api:1.0
ENTRYPOINT ["sh","-c","java -jar $JAVA_OPTS Chatbot-api.jar $PARAMS"]

```

ç„¶ååœ¨æœåŠ¡å™¨buildé•œåƒï¼š**ï¼ˆè®°å¾—å‘½ä»¤åä¸€å®šè¦åŠ ä¸€ä¸ªç‚¹ï¼ï¼‰**

```bash
docker build -t chatbot-glm .
[+] Building 45.9s (8/8) FINISHED              
```

![image-20231116143047088](https://raw.sevencdn.com/Bo-Vane/picgo/main/img/202311161430976.png)

```bash
[root@bovane idea]# docker run -d -P --name bovane-chatbot chatbot-glm
1cad6bf88cb1f707482f3060d4bc3fda92709498a8b96bc6c1ad2c3a67c0e108
[root@bovane idea]# docker ps
CONTAINER ID   IMAGE         COMMAND                  CREATED              STATUS              PORTS                                         NAMES
1cad6bf88cb1   chatbot-glm   "sh -c 'java -jar $Jâ€¦"   About a minute ago   Up About a minute   0.0.0.0:32773->8090/tcp, :::32773->8090/tcp   bovane-chatbot

```

æ‰“å¼€å‘ç°å·²æœ‰å›å¤è¯´æ˜è¿è¡ŒæˆåŠŸï¼

## éƒ¨ç½²springboot+mysqlé¡¹ç›®ï¼Œè‡ªå®šä¹‰ç½‘ç»œmynetï¼Œå¹¶å°†mysqlå’Œspringé¡¹ç›®å®¹å™¨è¿è¡Œåœ¨è¯¥ç½‘ç»œï¼Œé‚£ä¹ˆymlé…ç½®æ–‡ä»¶ä¸­çš„mysqlçš„ipåº”è¯¥å†™ä»€ä¹ˆï¼Œæ ¹æ®ä¸Šé¢åº”è¯¥æ˜¯å¯ä»¥é€šè¿‡åå­—è®¿é—®ï¼Œä¸‹æ¬¡å†™å®¹å™¨åå­—è¯•è¯•
